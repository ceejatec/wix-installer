<?xml version='1.0' encoding='windows-1252'?>
<Wix xmlns='http://schemas.microsoft.com/wix/2006/wi'>

  <Product Id="*" Name="Couchbase Server 4.5.0" Version="4.5.0" Manufacturer="Couchbase Inc."
      UpgradeCode="01510917-D2BC-91D4-FD65-4743E498A007"
      Language="1033" Codepage="1252">

    <Package Id="*" Keywords="Installer" Description="Couchbase Server 4.5.0 Installer"
        Comments="Couchbase is a registered trademark of Couchbase Inc."
        Manufacturer="Couchbase Inc."
        Platform="x64"
        InstallerVersion="200" Languages="1033" Compressed="yes" SummaryCodepage="1252"/>

    <Media Id="1" Cabinet="Couchbase.cab" EmbedCab="yes" DiskPrompt="Only file"/>
    <Property Id="DiskPrompt" Value="Couchbase Server 4.5.0 Installation [1]"/>

    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFiles64Folder" Name="PFiles">
        <Directory Id="Couchbase" Name="Couchbase">
          <Directory Id="INSTALLDIR" Name="Couchbase Server 4.5.0"/>
          <!-- Contents of this directory generated by heat in Files.wxs -->
        </Directory>
      </Directory>
    </Directory>

    <Feature Id="Complete" Level="1" Title="Couchbase Server" Description="The Complete Package."
        ConfigurableDirectory="INSTALLDIR">
      <ComponentGroupRef Id="CouchbaseServer"/>
    </Feature>

    <!-- Custom action to fix up config files based on installation dir -->
    <CustomAction Id="FixConfigCmd" Property="QtExec64CmdLine" Value="&quot;[SystemFolder]cmd.exe&quot; /c &quot;&quot;[INSTALLDIR]\bin\fixpaths.cmd&quot; &quot;[INSTALLDIR]&quot;&quot;"/>
    <CustomAction Id="FixConfig" BinaryKey="WixCA" DllEntry="CAQuietExec64" Return="check"/>

    <!-- Custom action to install the Erlang service -->
    <CustomAction Id="InstallServiceCmd" Property="QtExec64CmdLine" Value="&quot;[SystemFolder]cmd.exe&quot; /c &quot;&quot;[INSTALLDIR]\bin\service_register.bat&quot;"/>
    <CustomAction Id="InstallService" BinaryKey="WixCA" DllEntry="CAQuietExec64" Return="check"/>

    <InstallExecuteSequence>
      <!-- All actions to perform on Install, not Uninstall -->

      <!-- Fix Config files -->
      <Custom Action="FixConfigCmd" After="InstallFinalize">NOT Installed</Custom>
      <Custom Action="FixConfig" After="FixConfigCmd">NOT Installed</Custom>

      <!-- Install Service -->
      <Custom Action="InstallServiceCmd" After="FixConfig">NOT Installed</Custom>
      <Custom Action="InstallService" After="FixConfigCmd">NOT Installed</Custom>
    </InstallExecuteSequence>

    <!-- Load in "Mondo" UI toolkit -->
    <UIRef Id="WixUI_Mondo"/>
    <UIRef Id="WixUI_ErrorProgressText"/>

  </Product>
</Wix>
